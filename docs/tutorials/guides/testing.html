<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.17">
<title data-rh="true">Testing | Protostar</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://your-docusaurus-test-site.com/protostar/docs/tutorials/guides/testing"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Testing | Protostar"><meta data-rh="true" name="description" content="Protostar provides a flexible testing environment for Cairo smart contracts."><meta data-rh="true" property="og:description" content="Protostar provides a flexible testing environment for Cairo smart contracts."><link data-rh="true" rel="icon" href="/protostar/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://your-docusaurus-test-site.com/protostar/docs/tutorials/guides/testing"><link data-rh="true" rel="alternate" href="https://your-docusaurus-test-site.com/protostar/docs/tutorials/guides/testing" hreflang="en"><link data-rh="true" rel="alternate" href="https://your-docusaurus-test-site.com/protostar/docs/tutorials/guides/testing" hreflang="x-default"><link rel="stylesheet" href="/protostar/assets/css/styles.d9d38c80.css">
<link rel="preload" href="/protostar/assets/js/runtime~main.aef881b6.js" as="script">
<link rel="preload" href="/protostar/assets/js/main.5895e354.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/protostar/"><div class="navbar__logo"><img src="/protostar/img/protostar-logo--dark.png" alt="Protostar" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/protostar/img/protostar-logo--light.png" alt="Protostar" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">Protostar</b></a><a class="navbar__item navbar__link navbar__link--active" href="/protostar/docs/tutorials/introduction">Tutorials</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/software-mansion/protostar" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_S7eR toggle_TdHA toggleDisabled_f9M3"><div class="toggleButton_rCf9" role="button" tabindex="-1"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></div><input type="checkbox" class="toggleScreenReader_g2nN" aria-label="Switch between dark and light mode (currently light mode)"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/protostar/docs/tutorials/introduction">Introduction (1 min)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/protostar/docs/tutorials/installation">Installation (1 min)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/protostar/docs/tutorials/project-initialization">Project initialization (1 min)</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/protostar/docs/tutorials/guides/compiling">Guides</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/protostar/docs/tutorials/guides/compiling">Compilation (1 min)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/protostar/docs/tutorials/guides/dependencies-management">Dependencies (3 min)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/protostar/docs/tutorials/guides/testing">Testing (6 min)</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/protostar/">üè†</a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link breadcrumbsItemLink_e5ie">Guides</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/protostar/docs/tutorials/guides/testing">Testing (6 min)</a></li></ul></nav><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Testing</h1><p>Protostar provides a flexible testing environment for Cairo smart contracts.
It allows to write unit/integration tests with a help of <a href="#cheatcodes">cheatcodes</a>.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="unit-testing">Unit testing<a class="hash-link" href="#unit-testing" title="Direct link to heading">‚Äã</a></h2><p>We will start with a <a href="/protostar/docs/tutorials/project-initialization">just created protostar project</a>.
In your <code>src</code> directory create a <code>utils.cairo</code> file</p><div class="codeBlockContainer_I0IT language-code theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">src/utils.cairo</div><div class="codeBlockContent_wNvx code"><pre tabindex="0" class="prism-code language-code codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">func sum_func{syscall_ptr : felt*, range_check_ptr}(a : felt, b : felt) -&gt; (res : felt):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return (a+b)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>This is our target function, which we are going to test.
Then in the <code>tests</code> directory create file <code>test_utils.cairo</code>, which contains a single test case.</p><div class="codeBlockContainer_I0IT language-code theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">src/test_utils.cairo</div><div class="codeBlockContent_wNvx code"><pre tabindex="0" class="prism-code language-code codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">%lang starknet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from src.utils import sum_func</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@external</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func test_sum{syscall_ptr : felt*, range_check_ptr}():</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let (r) = sum_func(4,3)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    assert r = 7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return ()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Then run your test with</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">protostar test ./tests</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="codeBlockContainer_I0IT language-console theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">expected result</div><div class="codeBlockContent_wNvx console"><pre tabindex="0" class="prism-code language-console codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">Collected 1 items</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test_utils: .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----- TEST SUMMARY ------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 passed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Ran 1 out of 1 total tests</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>You can place your test files anywhere you want. Protostar recursively searches
the given directory for cairo files with a name starting with <code>test_</code> and treats them as tests files.
All functions inside a test file starting with <code>test_</code> are treated as separeate test cases.</p></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="deploying-contracts-from-tests">Deploying contracts from tests<a class="hash-link" href="#deploying-contracts-from-tests" title="Direct link to heading">‚Äã</a></h2><p>For most projects such testing of isolated functions won&#x27;t be enough. Protostar provides a <a href="#deploy_contract"><code>deploy_contract</code> cheatcode</a> to test interactions between contracts.
We will use an example of a simple storage contract to show you how to deploy contract inside a test case.</p><p>First, inside a <code>src</code> directory, create a <code>storage_contract.cairo</code></p><div class="codeBlockContainer_I0IT language-code theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">src/storage_contract.cairo</div><div class="codeBlockContent_wNvx code"><pre tabindex="0" class="prism-code language-code codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">%lang starknet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">%builtins pedersen range_check</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from starkware.cairo.common.cairo_builtins import HashBuiltin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from starkware.cairo.common.uint256 import Uint256, uint256_add</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Define a storage variable.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@storage_var</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func balance() -&gt; (res : Uint256):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@storage_var</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func id() -&gt; (res : felt):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Increases the balance by the given amount.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@external</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func increase_balance{syscall_ptr : felt*, pedersen_ptr : HashBuiltin*, range_check_ptr}(amount: Uint256):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let (read_balance) = balance.read()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let (new_balance, carry) = uint256_add(read_balance, amount)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    assert carry = 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    balance.write(new_balance)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return ()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Returns the current balance.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@view</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func get_balance{syscall_ptr : felt*, pedersen_ptr : HashBuiltin*, range_check_ptr}() -&gt; (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        res : Uint256):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let (res) = balance.read()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return (res)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@view</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func get_id{syscall_ptr : felt*, pedersen_ptr : HashBuiltin*, range_check_ptr}() -&gt; (res : felt):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let (res) = id.read()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return (res)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@constructor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func constructor{syscall_ptr : felt*, pedersen_ptr : HashBuiltin*, range_check_ptr}(initial_balance: Uint256, id: felt):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    balance.write(initial_balance)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    id.write(id)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return ()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Then we can create a test case for the contract.
Inside <code>tests</code> directory, create a <code>test_storage.cairo</code> file.</p><div class="codeBlockContainer_I0IT language-code theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">tests/test_storage.cairo</div><div class="codeBlockContent_wNvx code"><pre tabindex="0" class="prism-code language-code codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">%lang starknet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@contract_interface</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace StorageContract:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    func increase_balance(amount : felt):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    func get_balance() -&gt; (res : felt):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    func get_id() -&gt; (res: felt):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@external</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func test_proxy_contract{syscall_ptr : felt*, range_check_ptr}():</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    alloc_locals</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    local contract_a_address : felt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # We deploy contract and put its address into a local variable. Second argument is calldata array</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    %{ ids.contract_a_address = deploy_contract(&quot;./src/commands/test/examples/basic_with_constructor.cairo&quot;, [100, 0, 1]).contract_address %}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let (res) = StorageContract.get_balance(contract_address=contract_a_address)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    assert res.low = 100</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    assert res.high = 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let (id) = StorageContract.get_id(contract_address=contract_a_address)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    assert id = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    StorageContract.increase_balance(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        contract_address=contract_address,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        amount=Uint256(50, 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let (res) = StorageContract.get_balance(contract_address=contract_address)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    assert res.low = 150</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    assert res.high = 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return ()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>Please refer to <a href="https://www.cairo-lang.org/docs/hello_starknet/more_features.html#passing-tuples-and-structs-in-calldata" target="_blank" rel="noopener noreferrer">&quot;passing typles and structs in calldata&quot;</a> on how to serialize your constructor arguments to array of integers</p></div></div><p>Then run your test with</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">protostar test ./tests</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="codeBlockContainer_I0IT language-console theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">expected result</div><div class="codeBlockContent_wNvx console"><pre tabindex="0" class="prism-code language-console codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">Collected 2 items</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">storage_test: .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test_utils: .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----- TEST SUMMARY ------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2 passed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Ran 2 out of 2 total tests</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="asserts">Asserts<a class="hash-link" href="#asserts" title="Direct link to heading">‚Äã</a></h2><p>Protostar ships with its own assert functions. They don&#x27;t accept <a href="https://www.cairo-lang.org/docs/how_cairo_works/builtins.html?highlight=implicit%20arguments#implicit-arguments" target="_blank" rel="noopener noreferrer">implicit arguments</a> compared to asserts from <a href="https://github.com/starkware-libs/cairo-lang/blob/master/src/starkware/cairo/common/math.cairo" target="_blank" rel="noopener noreferrer"><code>starkware.cairo.common.math</code></a>. You can import Protostar asserts in the following way:</p><div class="codeBlockContainer_I0IT language-cairo theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">test_my_contract.cairo</div><div class="codeBlockContent_wNvx cairo"><pre tabindex="0" class="prism-code language-cairo codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">from protostar.asserts import (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    assert_eq, assert_not_eq, assert_signed_lt, assert_signed_le, assert_signed_gt,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    assert_unsigned_lt, assert_unsigned_le, assert_unsigned_gt, assert_signed_ge,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    assert_unsigned_ge)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>If your IDE supports Cairo and doesn&#x27;t know how to import <code>protostar</code>, add the following directory
<code>$(which protostar)/../cairo</code> to the <a href="https://www.cairo-lang.org/docs/how_cairo_works/imports.html?highlight=cairo_path" target="_blank" rel="noopener noreferrer"><code>CAIRO_PATH</code></a>.</p></div></div><p>You can find all <a href="https://github.com/software-mansion/protostar/blob/master/cairo/protostar/asserts.cairo" target="_blank" rel="noopener noreferrer">assert signatures here</a>.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="cheatcodes">Cheatcodes<a class="hash-link" href="#cheatcodes" title="Direct link to heading">‚Äã</a></h2><p>Most of the time, testing smart contracts with assertions only is not enough. Some test cases require manipulating the state of the blockchain, as well as checking for reverts and events. For that reason, Protostar provides a set of cheatcodes.</p><p>Cheatcodes are available inside of <a href="https://www.cairo-lang.org/docs/hello_cairo/program_input.html#hints" target="_blank" rel="noopener noreferrer">Cairo hints</a>. You don&#x27;t have to import anything. When Protostar runs tests, it replaces some core elements in <a href="https://pypi.org/project/cairo-lang/" target="_blank" rel="noopener noreferrer">cairo-lang</a> library and inject cheatcodes to the hint scope.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>If you are familiar with <a href="https://book.getfoundry.sh/forge/cheatcodes.html" target="_blank" rel="noopener noreferrer">Foundry</a>, you will recognize most cheatcodes.</p></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="mock_call"><code>mock_call</code><a class="hash-link" href="#mock_call" title="Direct link to heading">‚Äã</a></h3><div class="codeBlockContainer_I0IT language-python theme-code-block"><div class="codeBlockContent_wNvx python"><pre tabindex="0" class="prism-code language-python codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mock_call</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">contract_address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> fn_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ret_data</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> List</span><span class="token punctuation" style="color:#393A34">[</span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Mocks all calls to function with the name <code>fn_name</code> of a contract with an address <code>contract_address</code> unless <a href="#clear_mock_call"><code>clear_mock_call</code></a> is used. Mocked call returns data provided in <code>ret_data</code>.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="representing-different-data-structures-in-ret_data">Representing different data structures in <code>ret_data</code><a class="hash-link" href="#representing-different-data-structures-in-ret_data" title="Direct link to heading">‚Äã</a></h4><p>To use <code>mock_call</code> effectively, you need to understand how Cairo data structures are represented under the hood. <code>Cairo-lang</code> operates on list of integers. The following examples demonstrate how each data structure is represented in Python code.</p><h5 class="anchor anchorWithStickyNavbar_mojV" id="felt">Felt<a class="hash-link" href="#felt" title="Direct link to heading">‚Äã</a></h5><div class="codeBlockContainer_I0IT language-cairo theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">mocked_call returns a felt</div><div class="codeBlockContent_wNvx cairo"><pre tabindex="0" class="prism-code language-cairo codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">%lang starknet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@contract_interface</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace ITestContract:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    func get_felt() -&gt; (res : felt):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const EXTERNAL_CONTRACT_ADDRESS = 0x3fe90a1958bb8468fb1b62970747d8a00c435ef96cda708ae8de3d07f1bb56b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@view</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func test_mock_call_returning_felt{syscall_ptr : felt*, range_check_ptr}():</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tempvar external_contract_address = EXTERNAL_CONTRACT_ADDRESS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  %{ mock_call(ids.external_contract_address, &quot;get_felt&quot;, [42]) %}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let (res) = ITestContract.get_felt(EXTERNAL_CONTRACT_ADDRESS)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  assert res = 42</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return ()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h5 class="anchor anchorWithStickyNavbar_mojV" id="array">Array<a class="hash-link" href="#array" title="Direct link to heading">‚Äã</a></h5><p>To mock a function returning an array, provide data in the following format to <code>ret_data</code>:</p><div class="codeBlockContainer_I0IT language-python theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">Python representation of a Cairo array</div><div class="codeBlockContent_wNvx python"><pre tabindex="0" class="prism-code language-python codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">n</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> value_1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> value_2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> value_n</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="codeBlockContainer_I0IT language-cairo theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">mocked_call returns an array</div><div class="codeBlockContent_wNvx cairo"><pre tabindex="0" class="prism-code language-cairo codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">%lang starknet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@contract_interface</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace ITestContract:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    func get_array() -&gt; (res_len : felt, res : felt*):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const EXTERNAL_CONTRACT_ADDRESS = 0x3fe90a1958bb8468fb1b62970747d8a00c435ef96cda708ae8de3d07f1bb56b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@view</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func test_mock_call_returning_array{syscall_ptr : felt*, range_check_ptr}():</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tempvar external_contract_address = EXTERNAL_CONTRACT_ADDRESS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  %{ mock_call(ids.external_contract_address, &quot;get_array&quot;, [1, 42]) %}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let (res_len, res_arr) = ITestContract.get_array(EXTERNAL_CONTRACT_ADDRESS)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  assert res_arr[0] = 42</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return ()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h5 class="anchor anchorWithStickyNavbar_mojV" id="struct">Struct<a class="hash-link" href="#struct" title="Direct link to heading">‚Äã</a></h5><div class="codeBlockContainer_I0IT language-cairo theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">mocked_call returns a struct</div><div class="codeBlockContent_wNvx cairo"><pre tabindex="0" class="prism-code language-cairo codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">%lang starknet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct Point:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    member x : felt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    member y : felt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@contract_interface</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace ITestContract:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    func get_struct() -&gt; (res : Point):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const EXTERNAL_CONTRACT_ADDRESS = 0x3fe90a1958bb8468fb1b62970747d8a00c435ef96cda708ae8de3d07f1bb56b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@view</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func test_mock_call_returning_struct{syscall_ptr : felt*, range_check_ptr}():</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tempvar external_contract_address = EXTERNAL_CONTRACT_ADDRESS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  %{ mock_call(ids.external_contract_address, &quot;get_struct&quot;, [21,37]) %}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let (res_struct) = ITestContract.get_struct(EXTERNAL_CONTRACT_ADDRESS)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  assert res_struct.x = 21</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  assert res_struct.y = 37</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return ()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="clear_mock_call"><code>clear_mock_call</code><a class="hash-link" href="#clear_mock_call" title="Direct link to heading">‚Äã</a></h3><div class="codeBlockContainer_I0IT language-python theme-code-block"><div class="codeBlockContent_wNvx python"><pre tabindex="0" class="prism-code language-python codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">clear_mock_call</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">contract_address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> fn_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Removes a mocked call specified by a function name (<code>fn_name</code>) of a contract with an address (<code>contract_address</code>).</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="expect_revert"><code>expect_revert</code><a class="hash-link" href="#expect_revert" title="Direct link to heading">‚Äã</a></h3><div class="codeBlockContainer_I0IT language-python theme-code-block"><div class="codeBlockContent_wNvx python"><pre tabindex="0" class="prism-code language-python codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">expect_revert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">error_type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Optional</span><span class="token punctuation" style="color:#393A34">[</span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> error_message</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Optional</span><span class="token punctuation" style="color:#393A34">[</span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> Callable</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>If a code beneath <code>expect_revert</code> raises a specified exception, a test will pass. If not, a test will fail. It accepts <code>error_type</code>, <code>error_message</code>, and returns a function that cancels this cheatcode. Calling that function is optional.</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>Protostar displays an error type and message when a test fails.</p></div></div><div class="codeBlockContainer_I0IT language-cairo theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">This test passes despite calling an uninitialized contract.</div><div class="codeBlockContent_wNvx cairo"><pre tabindex="0" class="prism-code language-cairo codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">%lang starknet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@contract_interface</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace BasicContract:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    func increase_balance(amount : felt):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    func get_balance() -&gt; (res : felt):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@external</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func test_failing_to_call_external_contract{syscall_ptr : felt*, range_check_ptr}():</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    alloc_locals</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    local contract_a_address : felt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    %{ ids.contract_a_address = 3421347281347298134789213489213 %}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    %{ stop_expecting_revert = expect_revert(&quot;UNINITIALIZED_CONTRACT&quot;) %}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    BasicContract.increase_balance(contract_address=contract_a_address, amount=3)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    %{ stop_expecting_revert() %}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return ()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="deploy_contract"><code>deploy_contract</code><a class="hash-link" href="#deploy_contract" title="Direct link to heading">‚Äã</a></h3><div class="codeBlockContainer_I0IT language-python theme-code-block"><div class="codeBlockContent_wNvx python"><pre tabindex="0" class="prism-code language-python codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">deploy_contract</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">contract_path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> constructor_calldata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> List</span><span class="token punctuation" style="color:#393A34">[</span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> DeployedContact</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">DeployedContact</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    contract_address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Deploys a contract given a path relative to a Protostar project root. The section <a href="#deploying-contracts-from-tests">Deploying contracts from tests</a> demonstrates a usage of this cheatcode.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="start_prank"><code>start_prank</code><a class="hash-link" href="#start_prank" title="Direct link to heading">‚Äã</a></h3><div class="codeBlockContainer_I0IT language-python theme-code-block"><div class="codeBlockContent_wNvx python"><pre tabindex="0" class="prism-code language-python codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">start_prank</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">caller_address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Changes caller address until <a href="#stop_prank"><code>stop_prank</code></a> cheatcode is used.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="stop_prank"><code>stop_prank</code><a class="hash-link" href="#stop_prank" title="Direct link to heading">‚Äã</a></h3><div class="codeBlockContainer_I0IT language-python theme-code-block"><div class="codeBlockContent_wNvx python"><pre tabindex="0" class="prism-code language-python codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">stop_prank</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Resets caller address. Always used with <a href="#start_prank"><code>start_prank</code></a>.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="roll"><code>roll</code><a class="hash-link" href="#roll" title="Direct link to heading">‚Äã</a></h3><div class="codeBlockContainer_I0IT language-python theme-code-block"><div class="codeBlockContent_wNvx python"><pre tabindex="0" class="prism-code language-python codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">roll</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">blk_number</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Sets block number.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="warp"><code>warp</code><a class="hash-link" href="#warp" title="Direct link to heading">‚Äã</a></h3><div class="codeBlockContainer_I0IT language-python theme-code-block"><div class="codeBlockContent_wNvx python"><pre tabindex="0" class="prism-code language-python codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">warp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">blk_timestamp</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Sets block timestamp.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/software-mansion/protostar/tree/master/website/docs/tutorials/guides/testing.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/protostar/docs/tutorials/guides/dependencies-management"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Dependencies (3 min)</div></a></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#unit-testing" class="table-of-contents__link toc-highlight">Unit testing</a></li><li><a href="#deploying-contracts-from-tests" class="table-of-contents__link toc-highlight">Deploying contracts from tests</a></li><li><a href="#asserts" class="table-of-contents__link toc-highlight">Asserts</a></li><li><a href="#cheatcodes" class="table-of-contents__link toc-highlight">Cheatcodes</a><ul><li><a href="#mock_call" class="table-of-contents__link toc-highlight"><code>mock_call</code></a></li><li><a href="#clear_mock_call" class="table-of-contents__link toc-highlight"><code>clear_mock_call</code></a></li><li><a href="#expect_revert" class="table-of-contents__link toc-highlight"><code>expect_revert</code></a></li><li><a href="#deploy_contract" class="table-of-contents__link toc-highlight"><code>deploy_contract</code></a></li><li><a href="#start_prank" class="table-of-contents__link toc-highlight"><code>start_prank</code></a></li><li><a href="#stop_prank" class="table-of-contents__link toc-highlight"><code>stop_prank</code></a></li><li><a href="#roll" class="table-of-contents__link toc-highlight"><code>roll</code></a></li><li><a href="#warp" class="table-of-contents__link toc-highlight"><code>warp</code></a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/protostar/docs/tutorials/introduction">Tutorials</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2022 Protostar, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/protostar/assets/js/runtime~main.aef881b6.js"></script>
<script src="/protostar/assets/js/main.5895e354.js"></script>
</body>
</html>